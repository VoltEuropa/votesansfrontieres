/**
 * Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do
 * so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 **/
/** 
  * CUSTOM VERSION 
  * https://lab.nexedi.com/nexedi/rsvp.js/raw/master/dist/rsvp-2.0.4.js
  **/
!function(e){var t,f,a,l;a={},l={},f=function(e){if(l[e])return l[e];l[e]={};var t=a[e];if(!t)throw new Error("Module '"+e+"' not found.");for(var n,r=t.deps,o=t.callback,i=[],s=0,c=r.length;s<c;s++)"exports"===r[s]?i.push(n={}):i.push(f(r[s]));var u=o.apply(this,i);return l[e]=n||u},(t=function(e,t,n){a[e]={deps:t,callback:n}})("rsvp/all",["rsvp/promise","exports"],function(e,t){"use strict";var n=e.Promise;function r(a,l){if("[object Array]"!==Object.prototype.toString.call(l))throw new TypeError("You must pass an array to all.");function p(){for(var e,t=0;t<l.length;t++)(e=l[t])&&"function"==typeof e.then&&"function"==typeof e.cancel&&e.cancel()}return new n(function(n,t){var e,r=[],o=l.length,i=l.length-a;function s(t){return function(e){c(t,e)}}function c(e,t){r[e]=t,--o===i&&(0===i?n(r):(n(t),p()))}function u(e){t(e),p()}0===o&&(1===a?n():n([]));for(var f=0;f<l.length;f++)(e=l[f])&&"function"==typeof e.then?e.then(s(f),u):c(f,e)},p)}t.all=function(e){return r(e.length,e)},t.any=function(e){return r(1,e)}}),t("rsvp/async",["exports"],function(e){"use strict";var t,n,r,o,i,s="undefined"!=typeof window?window:{},c=s.MutationObserver||s.WebKitMutationObserver,u="undefined"!=typeof global?global:this;!function(){if("function"==typeof Promise&&"function"==typeof Promise.resolve)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return!0}catch(e){}return!1}()?"function"==typeof setImmediate?t=function(e,t){setImmediate(function(){e(t)})}:"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t=function(e,t){process.nextTick(function(){e(t)})}:c?(n=[],r=new c(function(){var e=n.slice();n=[],e.forEach(function(e){(0,e[0])(e[1])})}),o=document.createElement("div"),r.observe(o,{attributes:!0}),window.addEventListener("unload",function(){r.disconnect(),r=null},!1),t=function(e,t){n.push([e,t]),o.setAttribute("drainQueue","drainQueue")}):t=function(e,t){u.setTimeout(function(){e(t)},1)}:(i=Promise.resolve(),t=function(e,t){i.then(function(){e(t)})}),e.async=t}),t("rsvp/cancellation_error",["exports"],function(e){"use strict";function t(e){if(this.name="cancel",void 0!==e&&"string"!=typeof e)throw new TypeError("You must pass a string.");this.message=e||"Default Message"}(t.prototype=new Error).constructor=t,e.CancellationError=t}),t("rsvp/config",["rsvp/async","exports"],function(e,t){"use strict";var n=e.async,r={};r.async=n,t.config=r}),t("rsvp/defer",["rsvp/promise","exports"],function(e,t){"use strict";var r=e.Promise;t.defer=function(){var n={resolve:void 0,reject:void 0,promise:void 0};return n.promise=new r(function(e,t){n.resolve=e,n.reject=t}),n}}),t("rsvp/events",["exports"],function(e){"use strict";var u=function(e,t){for(var n in this.type=e,t)t.hasOwnProperty(n)&&(this[n]=t[n])},s=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n][0]===t)return n;return-1},f=function(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t},t={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e},on:function(e,t,n){var r,o,i=f(this);for(e=e.split(/\s+/),n=n||this;o=e.shift();)(r=i[o])||(r=i[o]=[]),-1===s(r,t)&&r.push([t,n])},off:function(e,t){var n,r,o,i=f(this);for(e=e.split(/\s+/);r=e.shift();)t?(n=i[r],-1!==(o=s(n,t))&&n.splice(o,1)):i[r]=[]},trigger:function(e,t){var n,r,o,i,s;if(n=f(this)[e])for(var c=0;c<n.length;c++)o=(r=n[c])[0],i=r[1],"object"!=typeof t&&(t={detail:t}),s=new u(e,t),o.call(i,s)}};e.EventTarget=t}),t("rsvp/hash",["rsvp/defer","exports"],function(e,t){"use strict";var u=e.defer;t.hash=function(e){var n={},r=u(),o=function(e){var t=0;for(var n in e)t++;return t}(e);0===o&&r.resolve({});var t=function(t){return function(e){i(t,e)}},i=function(e,t){n[e]=t,0==--o&&r.resolve(n)},s=function(e){r.reject(e)};for(var c in e)e[c]&&"function"==typeof e[c].then?e[c].then(t(c),s):i(c,e[c]);return r.promise}}),t("rsvp/node",["rsvp/promise","rsvp/all","exports"],function(e,t,n){"use strict";var r=e.Promise,c=t.all;n.denodeify=function(s){return function(){var o,i,e=Array.prototype.slice.call(arguments),t=this,n=new r(function(e,t){o=e,i=t});return c(e).then(function(e){var n,r;e.push((n=o,r=i,function(e,t){e?r(e):2<arguments.length?n(Array.prototype.slice.call(arguments,1)):n(t)}));try{s.apply(t,e)}catch(e){i(e)}}),n}}}),t("rsvp/promise",["rsvp/config","rsvp/events","rsvp/cancellation_error","exports"],function(e,t,n,r){"use strict";var o=e.config,i=t.EventTarget,s=n.CancellationError;function f(e){return"function"==typeof e}var c=function(e,t){var n=this,r=!1;if("function"!=typeof e)throw new TypeError("You must pass a resolver function as the sole argument to the promise constructor");if(void 0!==t&&"function"!=typeof t)throw new TypeError("You can only pass a canceller function as the second argument to the promise constructor");if(!(n instanceof c))return new c(e,t);var o=function(e){r||(r=!0,h(n,e))};this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this),this.on("error",u),this.cancel=function(){if(!r){if(void 0!==t)try{t()}catch(e){return void o(e)}o(new s)}};try{e(function(e){r||(r=!0,l(n,e))},o)}catch(e){o(e)}};function u(e){o.onerror&&o.onerror(e.detail)}var a=function(e,t,n,r){var o,i,s,c,u=f(n);if(!t.isFulfilled&&!t.isRejected){if(u)try{o=n(r.detail),s=!0}catch(e){c=!0,i=e}else o=r.detail,s=!0;p(t,o)||(u&&s?l(t,o):c?h(t,i):"resolve"===e?l(t,o):"reject"===e&&h(t,o))}};function l(e,t){e===t?v(e,t):p(e,t)||v(e,t)}function p(t,n){var r,e,o=null;try{if(t===n)throw new TypeError("A promises callback cannot return that same promise.");if((f(e=n)||"object"==typeof e&&null!==e)&&f(o=n.then))return t.on("promise:cancelled",function(e){f(n.cancel)&&n.cancel()}),o.call(n,function(e){if(r)return!0;r=!0,n!==e?l(t,e):v(t,e)},function(e){if(r)return!0;r=!0,h(t,e)}),!0}catch(e){return h(t,e),!0}return!1}function v(e,t){o.async(function(){e.isFulfilled||e.isRejected||(e.trigger("promise:resolved",{detail:t}),e.isFulfilled=!0,e.fulfillmentValue=t)})}function h(e,t){o.async(function(){e.isFulfilled||e.isRejected||(e.trigger("promise:failed",{detail:t}),e.isRejected=!0,e.rejectedReason=t)})}c.prototype={constructor:c,isRejected:void 0,isFulfilled:void 0,rejectedReason:void 0,fulfillmentValue:void 0,then:function(t,n){this.off("error",u);var r=new this.constructor(function(){},function(){r.trigger("promise:cancelled",{})});return this.isFulfilled&&o.async(function(e){a("resolve",r,t,{detail:e.fulfillmentValue})},this),this.isRejected&&o.async(function(e){a("reject",r,n,{detail:e.rejectedReason})},this),this.on("promise:resolved",function(e){a("resolve",r,t,e)}),this.on("promise:failed",function(e){a("reject",r,n,e)}),r},fail:function(e){return this.then(null,e)},always:function(e){return this.then(e,e)}},i.mixin(c.prototype),r.Promise=c}),t("rsvp/queue",["rsvp/promise","rsvp/resolve","exports"],function(e,t,n){"use strict";var u=e.Promise,f=t.resolve;function a(e){if(this.name="resolved",void 0!==e&&"string"!=typeof e)throw new TypeError("You must pass a string.");this.message=e||"Default Message"}(a.prototype=new Error).constructor=a;var l=function(){var e,o,i,s,r=this,c=[];if(!(this instanceof l))return new l;e=new u(function(t,n){o=function(e){if(!s)return r.isFulfilled=!0,r.fulfillmentValue=e,s=!0,t(e)},i=function(e){if(!s)return r.isRejected=!0,r.rejectedReason=e,s=!0,n(e)}},function(){for(var e=0;e<2;e++)c[e].cancel()}),c.push(f()),c.push(c[0].then(function(){c.splice(0,2),0===c.length&&o()})),r.cancel=function(){s||(s=!0,e.cancel(),e.fail(function(e){r.isRejected=!0,r.rejectedReason=e}))},r.then=function(){return e.then.apply(e,arguments)},r.push=function(e,t){var n,r=c[c.length-1];if(s)throw new a;return n=r.then(e,t),c.push(n),c.push(n.then(function(e){if(c.splice(0,2),0!==c.length)return e;o(e)},function(e){if(c.splice(0,2),0!==c.length)throw e;i(e)})),this}};l.prototype=Object.create(u.prototype),l.prototype.constructor=l,n.Queue=l,n.ResolvedQueueError=a}),t("rsvp/reject",["rsvp/promise","exports"],function(e,t){"use strict";var r=e.Promise;t.reject=function(n){return new r(function(e,t){t(n)})}}),t("rsvp/resolve",["rsvp/promise","exports"],function(e,t){"use strict";var n=e.Promise;t.resolve=function(r){return new n(function(e,t){if("object"==typeof r&&null!==r){var n=r.then;if(void 0!==n&&"function"==typeof n)return n.apply(r,[e,t])}return e(r)},function(){void 0!==r&&void 0!==r.cancel&&r.cancel()})}}),t("rsvp/rethrow",["exports"],function(e){"use strict";var t="undefined"==typeof global?this:global;e.rethrow=function(e){throw t.setTimeout(function(){throw e}),e}}),t("rsvp/timeout",["rsvp/promise","exports"],function(e,t){"use strict";var s=e.Promise;function n(n,r,o){var i;return new s(function(e,t){i=setTimeout(function(){r?t(o):e(o)},n)},function(){clearTimeout(i)})}function r(e,t){return n(e,!1,t)}s.prototype.delay=function(t){return this.then(function(e){return r(t,e)})},t.delay=r,t.timeout=function(e){return n(e,!0,"Timed out after "+e+" ms")}}),t("rsvp",["rsvp/events","rsvp/cancellation_error","rsvp/promise","rsvp/node","rsvp/all","rsvp/queue","rsvp/timeout","rsvp/hash","rsvp/rethrow","rsvp/defer","rsvp/config","rsvp/resolve","rsvp/reject","exports"],function(e,t,n,r,o,i,s,c,u,f,a,l,p,v){"use strict";var h=e.EventTarget,d=t.CancellationError,m=n.Promise,y=r.denodeify,g=o.all,w=o.any,j=i.Queue,b=i.ResolvedQueueError,E=s.delay,x=s.timeout,P=c.hash,R=u.rethrow,T=f.defer,Q=a.config,F=l.resolve,k=p.reject;v.CancellationError=d,v.Promise=m,v.EventTarget=h,v.all=g,v.any=w,v.Queue=j,v.ResolvedQueueError=b,v.delay=E,v.timeout=x,v.hash=P,v.rethrow=R,v.defer=T,v.denodeify=y,v.configure=function(e,t){Q[e]=t},v.resolve=F,v.reject=k}),window.RSVP=f("rsvp")}(window);