!function(e,t,n,r,o,a,i,u,s,l,c){"use strict";var d,h={},f=t(e),p=(e.location,"vsf_jio"),g="https://raw.githubusercontent.com/VoltEuropa/votesansfrontieres/master/lang/",m=e.document,v="09/05/2021 00:00:00 PM GMT+0100",_=".days",y=".hours",w=".minutes",S=".seconds",b="0";function M(e){var t;return new n.Promise(function(n,r){(t=new a).open("GET",e),t.onreadystatechange=function(){try{0===t.readyState?r(t):4===t.readyState&&(t.status<200||t.status>=300||!/^text\/html[;]?/.test(t.getResponseHeader("Content-Type")||"")?r(t):n(t))}catch(e){r(e)}},t.setRequestHeader("Accept","text/html"),t.withCredentials=!0,t.send()},function(){void 0!==t&&t.readyState!==t.DONE&&t.abort()})}function C(e){var t=e.indexOf("#");return t>0&&(e=e.substring(0,t)),e}function A(e){var t,n,r=[];if(null===e)return r;for(t=e.querySelectorAll("a"),n=0;n<t.length;n+=1)r.push({href:t[n].href,text:t[n].textContent});return r}function D(e){if(null!==e)return e.outerHTML}function L(e,t){var n,r,o,a,i,s,l,c,d,h=["src","href","srcset","action"];if(void 0!==t)for(a=0;a<h.length;a+=1)for(i=h[a],o=e.querySelectorAll("["+i+"]"),n=0;n<o.length;n+=1)"#"!==(s=(r=o[n]).getAttribute(i)).charAt(0)&&r.setAttribute(i,new u(s,t).href);return{original_content:e.innerHTML,html_content:e.querySelector(".page-content").innerHTML,document_list:A(e.querySelector("aside#document_list")),form_html_content:D(e.querySelector("form#main_form")),portal_status_message:(l=e.querySelector("p#portal_status_message"),c=e.querySelector("p#information_area"),d="",null!==l&&(d=l.textContent),null!==c&&(d=c.textContent),d)}}function T(t,r,o){return new n.Queue(n.hash({xhr:M(r)})).push(function(n){var r,o,a=(new i).parseFromString(n.xhr.responseText,"text/html");return r=t.element.querySelector(".page-content"),o=L(a.body,a.baseURI),t.parsed_content=o,o.page_title=a.title,r.innerHTML=o.html_content,e.componentHandler.upgradeDom(),t.fetchTranslationAndUpdateDom(t.state.locale)})}function x(e,t){return e.querySelector(t)}function R(e){return{type:"vsf_storage",repo:"votesansfrontieres",path:"lang/"+e}}String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(TEMPLATE_PARSER,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),f.setState({locale:(d=e.navigator,d.languages?d.languages[0]:d.language||d.userLanguage).substring(0,2)||"en",online:null,sw_errors:0}).ready(function(e){var t=e.element;e.property_dict={layout:x(t,".vote-layout"),url_dict:{},content_dict:{},i18n_dict:{}}}).allowPublicAcquisition("reportServiceError",function(){throw this.element.hidden=!1,t.AcquisitionError()}).declareMethod("route",function(e,t,n,r,o){return this.getDeclaredGadget(e).push(function(e){return e[t](n,r,o)})}).declareMethod("vsf_create",function(e){return this.route(p,"createJIO",e)}).declareMethod("vsf_get",function(e){return this.route(p,"get",e)}).declareMethod("vsf_allDocs",function(){return this.route(p,"allDocs")}).declareMethod("stateChange",function(e){var t=this.state;e.hasOwnProperty("locale")&&(t.locale=e.locale),e.hasOwnProperty("mode")&&(t.mode=e.mode),e.hasOwnProperty("online")&&(t.online=e.online,t.online?this.element.classList.remove("vote-offline"):this.element.classList.add("vote-offline"))}).declareMethod("translateDom",function(e){this.property_dict;var t,n,r,o=this.element.querySelectorAll("[data-i18n]"),a=o.length;for(t=0;t<a;t+=1)(r=e[(n=o[t]).getAttribute("data-i18n")])&&(n.textContent=r)}).declareMethod("createIcsFile",function(e){var t=o(),n=e.vote_remind_title,r=e.vote_remind_date,a=e.vote_remind_location;t.addEvent(n?n.value:"Reminder: 1 week left to register for elections","",a&&this.state.location?this.state.location.replace("<br />",""):"",r?r.value:"08/29/2021 09:00:00 AM GMT+0100",v),t.download("Go_vote_reminder")}).declareMethod("fetchTranslationAndUpdateDom",function(e){var t=this,r=t.property_dict,o=r.url_dict;return(new n.Queue).push(function(){return t.vsf_get(o.ui)}).push(function(e){return r.i18n_dict=e,t.translateDom(e)})}).declareMethod("updateStorage",function(e){var t=this;if(e!==t.state.locale)return(new n.Queue).push(function(){return t.stateChange({locale:e})}).push(function(){return t.vsf_create(R(e))}).push(function(){return t.buildVsfLookupDict()}).push(function(){return t.fetchTranslationAndUpdateDom()})}).declareMethod("buildVsfLookupDict",function(){var e=this,t=e.property_dict;return(new n.Queue).push(function(){return e.vsf_allDocs()}).push(function(n){if(0===n.data.total_rows)return e.updateStorage("en");n.data.rows.map(function(e){t.url_dict[e.id.split("/").pop().replace(".json","")]=e.id})}).push(void 0,function(n){var r;for(r=1;r<32;r+=1)t.url_dict[r]=g+e.state.locale+"/"+r+".json";t.url_dict.ui=g+e.state.locale+"/ui.json"})}).declareMethod("render",function(t){var r,o,a=this,i=a.property_dict;return e.componentHandler.upgradeDom(),r=i,o=t,Object.keys(o).reduce(function(e,t){return e[t]=o[t],e},r),(new n.Queue).push(function(){return a.vsf_create(R(a.state.locale))}).push(function(){return a.buildVsfLookupDict()}).push(function(){return a.fetchTranslationAndUpdateDom(a.state.locale)})}).declareMethod("handleError",function(e,t){var n,r=e.target?JSON.parse(e.target.response).error:e;for(n in t)if(t.hasOwnProperty(n)&&r.status_code+""===n)return t[n];throw r}).declareJob("listenURLChange",function(){var t=this;return l.scrollRestoration&&(l.scrollRestoration="manual"),n.all([s(e,"popstate",!1,function(){return T(t,e.location.href,e.location.hash)},!1),s(t.element,"click",!1,function(n){var r,o=n.target.closest("a"),a=document.baseURI;if(o&&"_blank"!==o.target&&!(n.altKey||n.ctrlKey||n.metaKey||n.shiftKey||(r=new u(o.href,a),0!==a.indexOf(r.origin)||r.hash&&C(r.href)===C(e.location.href))))return n.preventDefault(),T(t,o.href,r.hash).push(function(){l.pushState(null,null,o.href)},function(t){c.warn("Cant render the page",t),e.location=o.href})},!0)])}).declareService(function(){var t,n,o,a,i,u,s;m.body.classList.remove("vsf-splash"),t=v,n=this.element,s=new r(t).getTime(),isNaN(s)||e.setInterval(function(){var e=(new r).getTime(),t=parseInt((s-e)/1e3,10);t>=0&&(o=parseInt(t/86400,10),t%=86400,a=parseInt(t/3600,10),t%=3600,i=parseInt(t/60,10),t%=60,u=parseInt(t,10),x(n,_)&&(x(n,_).textContent=parseInt(o,10),x(n,y).textContent=(b+a).slice(-2),x(n,w).textContent=(b+i).slice(-2),x(n,S).textContent=(b+u).slice(-2)))},1e3)}).declareService(function(){return this.render(h).push(null,function(e){throw e})}).declareService(function(){var e,r,o=this,a=o.element,i=a.getAttribute("data-nostyle-gadget-url"),s=a.getAttribute("data-nostyle-css-url");if(!i)return(new n.Queue).push(function(){o.listenURLChange(),o.element.hidden=!1},function(e){throw o.element.hidden=!1,e});for(r=L(o.element),o.parsed_content=r,r.page_title=document.title,o.style_gadget_url=new u(i,document.baseURI).href;a.firstChild;)a.firstChild.remove();return o.declareGadget(i,{scope:"renderer"}).push(function(t){return(e=t).render(r.html_content,r).push(function(){o.listenURLChange(),a.appendChild(e.element),o.element.hidden=!1},function(e){throw o.element.hidden=!1,e})},function(e){return c.warn("Cant load the style gadget",e),new n.Queue(t.declareCSS(s,document.head)).push(function(){o.element.innerHTML=r.original_content})})}).onEvent("submit",function(e){switch(e.target.getAttribute("name")){case"vsf-select-language":return this.updateStorage(e.target.vsf_language.value);case"vsf-reminder":return this.createIcsFile(e.target)}})}(window,rJS,RSVP,Date,ics,XMLHttpRequest,DOMParser,URL,loopEventListener,history,console);